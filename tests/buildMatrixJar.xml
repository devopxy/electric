<project name="createMatrixJar" basedir=".." default="createJar">

	<property name="dir.out" value="matrixJarOut" />
	<property name="dir.src" value="srcj" />
	<property name="dir.test" value="tests" />
	<property name="jar.name" value="${dir.test}/matrix.jar" />

	<patternset id="exclusion3D">
		<exclude name="com/sun/electric/plugins/JMF/" unless="JMF" />
		<exclude name="com/sun/electric/plugins/j3d/" if="NO3D" />
		<exclude name="com/sun/electric/plugins/Java3D/" if="NO3D" />
	</patternset>

	<path id="extjar">
		<fileset dir="packaging">
			<include name="*.jar" />
		</fileset>
	</path>

	<target name="cleanUp">
		<delete dir="${dir.out}" />
	</target>

	<target name="init">
		<mkdir dir="${dir.out}" />
	</target>

	<target name="compile">
		<javac srcdir="${dir.src}" destdir="${dir.out}" debug="true">
			<classpath refid="extjar" />
			<include name="**/*.java" />
			<patternset refid="exclusion3D" />
		</javac>

		<javac srcdir="${dir.test}" destdir="${dir.out}" debug="true">
			<classpath refid="extjar" />
			<include name="**/*.java" />
		</javac>
	</target>

	<target name="createJar" depends="cleanUp, init">
		<antcall target="compile">
			<param name="NO3D" value="0" />
		</antcall>

		<jar destfile="${jar.name}" basedir="${dir.out}">
			<manifest>
				<attribute name="Main-Class" value="com.sun.electric.tool.util.concurrent.test.PForJob_T" />
			</manifest>
		</jar>

		<antcall target="cleanUp">
		</antcall>
	</target>

	<target name="run">
		<java jar="${jar.name}" fork="true">
			<arg id="threads" value="--threads=16" />
			<arg id="size" value="--size=1" />
			<arg id="grain" value="--grain=1" />
			<arg id="out" value="--outfile=test.csv" />
			<arg id="scheduler" value="--scheduler=queue" />
		</java>
	</target>

</project>